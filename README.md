# FileServer

ä¸€ä¸ªä½¿ç”¨Goå®ç°çš„REST APIæ–‡ä»¶æœåŠ¡å™¨ï¼Œæ”¯æŒé…ç½®æ–‡ä»¶ä¸‹è½½åŠŸèƒ½å’Œç”¨æˆ·è®¤è¯ã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… REST APIæ¥å£
- âœ… é…ç½®æ–‡ä»¶ä¸‹è½½åŠŸèƒ½
- âœ… ç”¨æˆ·è®¤è¯å’Œæˆæƒ
- âœ… å¤šç§Ÿæˆ·æ”¯æŒï¼ˆtenantid + usernameï¼‰
- âœ… Token-basedè®¤è¯ï¼ˆæ— æ„Ÿä½“éªŒï¼‰
- âœ… å¥åº·æ£€æŸ¥æ¥å£
- âœ… CORSæ”¯æŒ
- âœ… è¯·æ±‚æ—¥å¿—è®°å½•
- âœ… ä¼˜é›…å…³é—­

## é¡¹ç›®ç»“æ„

```
FileServer/
â”œâ”€â”€ cmd/server/         # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ internal/           # å†…éƒ¨åŒ…
â”‚   â”œâ”€â”€ auth/           # ç”¨æˆ·è®¤è¯æ¨¡å—
â”‚   â”œâ”€â”€ handler/        # HTTPå¤„ç†å™¨
â”‚   â”œâ”€â”€ middleware/     # ä¸­é—´ä»¶
â”‚   â””â”€â”€ server/         # æœåŠ¡å™¨é…ç½®
â”œâ”€â”€ configs/            # é…ç½®æ–‡ä»¶
â”œâ”€â”€ .gitignore          # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ go.mod              # Goæ¨¡å—æ–‡ä»¶
â””â”€â”€ README.md           # é¡¹ç›®è¯´æ˜
```

## å®‰è£…å’Œè¿è¡Œ

### å‰ç½®è¦æ±‚

- Go 1.19 æˆ–æ›´é«˜ç‰ˆæœ¬

### å®‰è£…ä¾èµ–

```bash
go mod download
```

### è¿è¡ŒæœåŠ¡å™¨

```bash
go run cmd/server/main.go
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:8080` å¯åŠ¨ã€‚

## APIæ¥å£

### ğŸ” è®¤è¯ç›¸å…³æ¥å£

#### è·å–é»˜è®¤æµ‹è¯•ç”¨æˆ·

```http
GET /api/v1/auth/users
```

è·å–é¢„è®¾çš„æµ‹è¯•ç”¨æˆ·åˆ—è¡¨ï¼ˆæ— éœ€è®¤è¯ï¼‰ã€‚

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "é»˜è®¤æµ‹è¯•ç”¨æˆ·åˆ—è¡¨",
  "data": {
    "users": [
      {
        "tenant_id": "demo",
        "username": "admin",
        "password": "admin123",
        "desc": "ç®¡ç†å‘˜è´¦æˆ·"
      },
      {
        "tenant_id": "demo",
        "username": "user1",
        "password": "password123",
        "desc": "æ™®é€šç”¨æˆ·è´¦æˆ·"
      },
      {
        "tenant_id": "tenant1",
        "username": "test",
        "password": "test123",
        "desc": "æµ‹è¯•è´¦æˆ·"
      }
    ]
  }
}
```

#### ç”¨æˆ·ç™»å½•

```http
POST /api/v1/auth/login
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "tenant_id": "demo",
  "username": "admin",
  "password": "admin123"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "abc123def456...",
    "expires_in": 86400,
    "user": {
      "tenant_id": "demo",
      "username": "admin"
    }
  }
}
```

#### ç”¨æˆ·ç™»å‡º

```http
POST /api/v1/auth/logout
Authorization: Bearer <token>
```

### ğŸ“ æ–‡ä»¶ç›¸å…³æ¥å£

#### ä¸‹è½½é…ç½®æ–‡ä»¶

```http
GET /api/v1/config/download
Authorization: Bearer <token>
```

ä¸‹è½½ `config.json` é…ç½®æ–‡ä»¶ã€‚**éœ€è¦è®¤è¯ã€‚**

**å“åº”ï¼š**
- æˆåŠŸï¼šè¿”å›é…ç½®æ–‡ä»¶å†…å®¹ï¼ŒContent-Type: `application/json`
- å¤±è´¥ï¼šè¿”å›é”™è¯¯ä¿¡æ¯çš„JSONå“åº”

### ğŸ©º ç³»ç»Ÿæ¥å£

#### å¥åº·æ£€æŸ¥

```http
GET /api/v1/health
```

æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼ˆæ— éœ€è®¤è¯ï¼‰ã€‚

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "æœåŠ¡è¿è¡Œæ­£å¸¸",
  "data": {
    "status": "healthy",
    "timestamp": "1640995200"
  }
}
```

## ä½¿ç”¨ç¤ºä¾‹

### ğŸš€ å¿«é€Ÿå¼€å§‹

#### 1. è·å–æµ‹è¯•ç”¨æˆ·ä¿¡æ¯

```bash
curl http://localhost:8080/api/v1/auth/users
```

#### 2. ç”¨æˆ·ç™»å½•

```bash
curl -X POST http://localhost:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "tenant_id": "demo",
    "username": "admin",
    "password": "admin123"
  }'
```

#### 3. ä½¿ç”¨tokenä¸‹è½½é…ç½®æ–‡ä»¶

```bash
# ä½¿ç”¨ä¸Šä¸€æ­¥è¿”å›çš„token
TOKEN=""
curl -H "Authorization: Bearer 7304073a5931c42401c7ed29204942286b41df1f392294d280cc3233c53aac39" \
  -O -J http://localhost:8080/api/v1/config/download
```

#### 4. ç™»å‡º

```bash
curl -X POST http://localhost:8080/api/v1/auth/logout \
  -H "Authorization: Bearer $TOKEN"
```

### ğŸŒ æµè§ˆå™¨ä½¿ç”¨

ç”±äºæµè§ˆå™¨æ— æ³•ç›´æ¥å‘é€Authorization headerï¼Œæ¨èä½¿ç”¨APIå·¥å…·ï¼ˆå¦‚Postmanã€Insomniaï¼‰æˆ–å‰ç«¯åº”ç”¨æ¥æµ‹è¯•è®¤è¯åŠŸèƒ½ã€‚

### ğŸ’¡ æ— æ„Ÿè®¤è¯ä½“éªŒ

ç”¨æˆ·åªéœ€è¦ï¼š
1. **ä¸€æ¬¡ç™»å½•** - è·å–token
2. **è‡ªåŠ¨æºå¸¦** - åœ¨åç»­è¯·æ±‚ä¸­æºå¸¦token
3. **é•¿æœŸæœ‰æ•ˆ** - tokenæœ‰æ•ˆæœŸ24å°æ—¶ï¼Œå‡å°‘é‡å¤ç™»å½•

å‰ç«¯åº”ç”¨å¯ä»¥ï¼š
- è‡ªåŠ¨å­˜å‚¨tokenåˆ°localStorage/sessionStorage
- åœ¨è¯·æ±‚æ‹¦æˆªå™¨ä¸­è‡ªåŠ¨æ·»åŠ Authorization header
- tokenè¿‡æœŸæ—¶è‡ªåŠ¨å¼•å¯¼ç”¨æˆ·é‡æ–°ç™»å½•

## é…ç½®è¯´æ˜

é…ç½®æ–‡ä»¶ä½äº `configs/config.json`ï¼ŒåŒ…å«ä»¥ä¸‹é…ç½®é¡¹ï¼š

- `server`: æœåŠ¡å™¨é…ç½®ï¼ˆä¸»æœºã€ç«¯å£ã€è¶…æ—¶ç­‰ï¼‰
- `application`: åº”ç”¨ç¨‹åºä¿¡æ¯
- `logging`: æ—¥å¿—é…ç½®
- `features`: åŠŸèƒ½å¼€å…³

## ğŸ”’ è®¤è¯è®¾è®¡

### å¤šç§Ÿæˆ·æ”¯æŒ
- ä½¿ç”¨ `tenant_id + username` çš„ç»„åˆæ¥å”¯ä¸€æ ‡è¯†ç”¨æˆ·
- æ”¯æŒä¸åŒç§Ÿæˆ·ä¸‹çš„åŒåç”¨æˆ·
- ä¾¿äºSaaSåº”ç”¨çš„å¤šç§Ÿæˆ·æ¶æ„

### æ— æ„Ÿè®¤è¯ä½“éªŒ
- **ä¸€æ¬¡ç™»å½•ï¼Œé•¿æœŸä½¿ç”¨**: 24å°æ—¶tokenæœ‰æ•ˆæœŸ
- **è‡ªåŠ¨è®¤è¯**: ä¸­é—´ä»¶è‡ªåŠ¨éªŒè¯token
- **ç®€å•é›†æˆ**: åªéœ€åœ¨è¯·æ±‚å¤´æ·»åŠ `Authorization: Bearer <token>`

### å®‰å…¨ç‰¹æ€§
- å¯†ç BCryptå“ˆå¸Œå­˜å‚¨
- Tokenè‡ªåŠ¨è¿‡æœŸæ¸…ç†
- è¯¦ç»†çš„è®¤è¯æ—¥å¿—è®°å½•

## æœ€ä½³å®è·µ

æœ¬é¡¹ç›®éµå¾ªGoé¡¹ç›®çš„æœ€ä½³å®è·µï¼š

1. **é¡¹ç›®ç»“æ„**: ä½¿ç”¨æ ‡å‡†çš„Goé¡¹ç›®å¸ƒå±€
2. **è®¤è¯æ¶æ„**: Token-basedè®¤è¯ï¼Œæ”¯æŒå¤šç§Ÿæˆ·
3. **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
4. **HTTPä¸­é—´ä»¶**: åˆ†å±‚ä¸­é—´ä»¶ï¼ˆæ—¥å¿—ã€CORSã€è®¤è¯ï¼‰
5. **ä¼˜é›…å…³é—­**: æ”¯æŒä¼˜é›…å…³é—­æœåŠ¡å™¨
6. **å®‰å…¨æ€§**: å¯†ç å“ˆå¸Œã€tokenéªŒè¯ã€é€‚å½“çš„HTTPå¤´éƒ¨
7. **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„ä»£ç ç»“æ„å’Œæ³¨é‡Š
8. **ç”¨æˆ·ä½“éªŒ**: æœ€å°åŒ–è®¤è¯å¤æ‚åº¦ï¼Œæä¾›é»˜è®¤æµ‹è¯•ç”¨æˆ·

## å¼€å‘

### æ„å»º

```bash
go build -o fileserver cmd/server/main.go
```

### æµ‹è¯•

```bash
go test ./...
```

## è®¸å¯è¯

MIT License