# Secure File Hub ç³»ç»Ÿæ¶æ„åˆ†æä¸é‡æ„å»ºè®®

## ğŸ“‹ å½“å‰æ¶æ„é—®é¢˜åˆ†æ

### ğŸ” 1. æ¶æ„æ··ä¹±ç‚¹è¯†åˆ«

#### 1.1 ä»£ç ç»„ç»‡ç»“æ„æ··ä¹±

**é—®é¢˜æè¿°ï¼š**
- é¡¹ç›®æ ¹ç›®å½•å­˜åœ¨å¤šä¸ªä¸ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼ˆconfigs/, certs/, downloads/ç­‰ï¼‰
- å‰åç«¯ä»£ç æ··åˆéƒ¨ç½²ï¼Œè€¦åˆåº¦è¿‡é«˜
- æµ‹è¯•ä»£ç åˆ†æ•£ï¼Œç¼ºä¹ç»Ÿä¸€ç®¡ç†

**å…·ä½“é—®é¢˜ï¼š**
```
å½“å‰ç»“æ„é—®é¢˜ï¼š
â”œâ”€â”€ cmd/server/         # ä¸»ç¨‹åºå…¥å£ âœ…
â”œâ”€â”€ internal/           # å†…éƒ¨åŒ… âœ…
â”œâ”€â”€ frontend/           # å‰ç«¯åº”ç”¨ âš ï¸ æ··åˆæ¶æ„
â”œâ”€â”€ configs/            # âŒ é…ç½®æ–‡ä»¶ä½ç½®æ··ä¹±
â”œâ”€â”€ certs/              # âŒ è¯ä¹¦æ–‡ä»¶æš´éœ²åœ¨æ ¹ç›®å½•
â”œâ”€â”€ downloads/          # âŒ ä¸šåŠ¡æ•°æ®ä¸ä»£ç æ··åˆ
â”œâ”€â”€ data/               # âŒ æ•°æ®åº“æ–‡ä»¶ä½ç½®ä¸å½“
â”œâ”€â”€ logs.db             # âŒ æ—¥å¿—æ–‡ä»¶æ•£è½æ ¹ç›®å½•
â””â”€â”€ tests/              # âš ï¸ æµ‹è¯•ç›®å½•ä½ç½®ä¸å½“
```

#### 1.2 æ¨¡å—è¾¹ç•Œä¸æ¸…æ™°

**é—®é¢˜è¯†åˆ«ï¼š**
- `internal/` æ¨¡å—èŒè´£é‡å ï¼Œç¼ºä¹æ¸…æ™°çš„è¾¹ç•Œå®šä¹‰
- `handler` æ¨¡å—æ‰¿æ‹…è¿‡å¤šè´£ä»»ï¼ˆHTTPå¤„ç†ã€ä¸šåŠ¡é€»è¾‘ã€æ–‡ä»¶æ“ä½œï¼‰
- `auth` æ¨¡å—ä¸ `database` æ¨¡å—è€¦åˆè¿‡ç´§
- ç¼ºä¹æ˜ç¡®çš„æœåŠ¡å±‚æŠ½è±¡

#### 1.3 é…ç½®ç®¡ç†æ··ä¹±

**é—®é¢˜åˆ†æï¼š**
- é…ç½®æ–‡ä»¶åˆ†æ•£åœ¨å¤šä¸ªç›®å½•ï¼ˆconfigs/, downloads/configs/ï¼‰
- ç¯å¢ƒå˜é‡ä¸é…ç½®æ–‡ä»¶æ··åˆä½¿ç”¨ï¼Œç¼ºä¹ç»Ÿä¸€ç®¡ç†
- æ•æ„Ÿä¿¡æ¯ï¼ˆè¯ä¹¦ã€å¯†é’¥ï¼‰ä¸æ™®é€šé…ç½®æ··åˆå­˜å‚¨

#### 1.4 æ•°æ®å­˜å‚¨æ¶æ„ä¸ä¸€è‡´

**é—®é¢˜è¯†åˆ«ï¼š**
- æ•°æ®åº“æ–‡ä»¶ (fileserver.db) ä½ç½®ä¸å½“
- æ–‡ä»¶å­˜å‚¨ç›®å½• (downloads/) ä¸åº”ç”¨ä»£ç æ··åˆ
- æ—¥å¿—å­˜å‚¨åˆ†æ•£ï¼ˆlogs.db åœ¨æ ¹ç›®å½•ï¼Œå…¶ä»–æ—¥å¿—åœ¨ logs/ï¼‰

### ğŸ—ï¸ 2. æ¨èçš„ç³»ç»Ÿæ¶æ„é‡æ„æ–¹æ¡ˆ

#### 2.1 æ¸…æ´æ¶æ„ï¼ˆClean Architectureï¼‰å®ç°

```mermaid
graph TB
    subgraph "å¤–å±‚ - æ¡†æ¶ä¸é©±åŠ¨"
        A1[HTTPæ¡†æ¶ - Gin/Gorilla]
        A2[æ•°æ®åº“é©±åŠ¨ - SQLite]
        A3[æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨]
        A4[å¤–éƒ¨APIå®¢æˆ·ç«¯]
    end

    subgraph "æ¥å£é€‚é…å±‚"
        B1[REST APIæ§åˆ¶å™¨]
        B2[æ•°æ®åº“ä»“å‚¨å®ç°]
        B3[æ–‡ä»¶ä»“å‚¨å®ç°]
        B4[è®¤è¯é€‚é…å™¨]
    end

    subgraph "åº”ç”¨å±‚ - ç”¨ä¾‹"
        C1[ç”¨æˆ·ç®¡ç†ç”¨ä¾‹]
        C2[æ–‡ä»¶ç®¡ç†ç”¨ä¾‹]
        C3[è®¤è¯æˆæƒç”¨ä¾‹]
        C4[APIç®¡ç†ç”¨ä¾‹]
    end

    subgraph "ä¸šåŠ¡é¢†åŸŸå±‚"
        D1[ç”¨æˆ·å®ä½“]
        D2[æ–‡ä»¶å®ä½“]
        D3[æƒé™å®ä½“]
        D4[ä¸šåŠ¡è§„åˆ™]
    end

    A1 --> B1
    A2 --> B2
    A3 --> B3
    A4 --> B4

    B1 --> C1
    B2 --> C1
    B3 --> C2
    B4 --> C3

    C1 --> D1
    C2 --> D2
    C3 --> D3
    C1 --> D4
```

#### 2.2 æ¨èçš„ç›®å½•ç»“æ„é‡æ„

```
secure-file-hub/
â”œâ”€â”€ cmd/                    # åº”ç”¨ç¨‹åºå…¥å£ç‚¹
â”‚   â”œâ”€â”€ api/               # APIæœåŠ¡å™¨ä¸»ç¨‹åº
â”‚   â”‚   â””â”€â”€ main.go
â”‚   â”œâ”€â”€ migration/         # æ•°æ®è¿ç§»å·¥å…·
â”‚   â”‚   â””â”€â”€ main.go
â”‚   â””â”€â”€ worker/            # åå°ä»»åŠ¡ç¨‹åº
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ internal/              # ç§æœ‰åº”ç”¨å’Œåº“ä»£ç 
â”‚   â”œâ”€â”€ domain/            # ä¸šåŠ¡é¢†åŸŸå±‚
â”‚   â”‚   â”œâ”€â”€ entities/      # ä¸šåŠ¡å®ä½“
â”‚   â”‚   â”œâ”€â”€ repositories/  # ä»“å‚¨æ¥å£
â”‚   â”‚   â””â”€â”€ services/      # é¢†åŸŸæœåŠ¡
â”‚   â”œâ”€â”€ application/       # åº”ç”¨ç”¨ä¾‹å±‚
â”‚   â”‚   â”œâ”€â”€ usecases/      # ç”¨ä¾‹å®ç°
â”‚   â”‚   â”œâ”€â”€ dto/           # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â””â”€â”€ interfaces/    # åº”ç”¨æ¥å£
â”‚   â”œâ”€â”€ infrastructure/    # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â”œâ”€â”€ database/      # æ•°æ®åº“å®ç°
â”‚   â”‚   â”œâ”€â”€ filesystem/    # æ–‡ä»¶ç³»ç»Ÿå®ç°
â”‚   â”‚   â”œâ”€â”€ http/          # HTTPå®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ config/        # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ presentation/      # è¡¨ç°å±‚
â”‚       â”œâ”€â”€ http/          # HTTPå¤„ç†å™¨
â”‚       â”œâ”€â”€ middleware/    # ä¸­é—´ä»¶
â”‚       â””â”€â”€ routes/        # è·¯ç”±å®šä¹‰
â”œâ”€â”€ web/                   # å‰ç«¯åº”ç”¨ï¼ˆç‹¬ç«‹éƒ¨ç½²ï¼‰
â”‚   â”œâ”€â”€ src/               # React/Next.jsæºç 
â”‚   â”œâ”€â”€ public/            # é™æ€èµ„æº
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ deployments/           # éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ docker/            # Dockerç›¸å…³æ–‡ä»¶
â”‚   â”œâ”€â”€ k8s/               # Kubernetesé…ç½®
â”‚   â””â”€â”€ terraform/         # åŸºç¡€è®¾æ–½ä»£ç 
â”œâ”€â”€ configs/               # é…ç½®æ–‡ä»¶æ¨¡æ¿
â”‚   â”œâ”€â”€ app.yaml.example
â”‚   â”œâ”€â”€ database.yaml.example
â”‚   â””â”€â”€ security.yaml.example
â”œâ”€â”€ scripts/               # æ„å»ºå’Œéƒ¨ç½²è„šæœ¬
â”œâ”€â”€ docs/                  # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ tests/                 # æµ‹è¯•ä»£ç 
â”‚   â”œâ”€â”€ unit/              # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ integration/       # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ e2e/               # ç«¯åˆ°ç«¯æµ‹è¯•
â”œâ”€â”€ migrations/            # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”œâ”€â”€ go.mod
â””â”€â”€ README.md
```

### ğŸ”§ 3. å…·ä½“é‡æ„å»ºè®®

#### 3.1 æ¨¡å—è§£è€¦é‡æ„

**å½“å‰é—®é¢˜ï¼š** `handler` æ¨¡å—èŒè´£è¿‡å¤š

**é‡æ„æ–¹æ¡ˆï¼š**
```go
// é‡æ„å‰ - internal/handler/handler.go ï¼ˆèŒè´£æ··ä¹±ï¼‰
type Handler struct {
    // HTTPå¤„ç†ã€ä¸šåŠ¡é€»è¾‘ã€æ•°æ®è®¿é—®å…¨éƒ¨æ··åˆ
}

// é‡æ„å - åˆ†ç¦»èŒè´£
// internal/presentation/http/controllers/file_controller.go
type FileController struct {
    fileUseCase application.FileUseCase
}

// internal/application/usecases/file_usecase.go
type FileUseCase struct {
    fileRepo domain.FileRepository
    authService domain.AuthService
}

// internal/domain/entities/file.go
type File struct {
    ID       string
    Name     string
    Path     string
    Owner    string
    // ... ä¸šåŠ¡å±æ€§
}

// internal/infrastructure/database/file_repository.go
type FileRepository struct {
    db *sql.DB
}
```

#### 3.2 é…ç½®ç®¡ç†é‡æ„

**é‡æ„æ–¹æ¡ˆï¼š**
```go
// internal/infrastructure/config/config.go
type Config struct {
    Server   ServerConfig   `yaml:"server"`
    Database DatabaseConfig `yaml:"database"`
    Security SecurityConfig `yaml:"security"`
    Storage  StorageConfig  `yaml:"storage"`
}

type ServerConfig struct {
    Host string `yaml:"host" env:"SERVER_HOST" default:"localhost"`
    Port int    `yaml:"port" env:"SERVER_PORT" default:"8443"`
    TLS  TLSConfig `yaml:"tls"`
}

type DatabaseConfig struct {
    Driver   string `yaml:"driver" default:"sqlite"`
    Host     string `yaml:"host" env:"DB_HOST"`
    Port     int    `yaml:"port" env:"DB_PORT"`
    Database string `yaml:"database" env:"DB_NAME"`
}
```

**é…ç½®æ–‡ä»¶ç»“æ„ï¼š**
```yaml
# configs/app.yaml
server:
  host: 0.0.0.0
  port: 8443
  tls:
    cert_file: /etc/ssl/certs/server.crt
    key_file: /etc/ssl/private/server.key

database:
  driver: sqlite
  database: /var/lib/fileserver/database.db

security:
  jwt:
    secret_key_env: JWT_SECRET_KEY
    expiration: 24h
  rate_limiting:
    enabled: true
    requests_per_minute: 100
```

#### 3.3 ä¾èµ–æ³¨å…¥é‡æ„

**å®ç°ä¾èµ–æ³¨å…¥å®¹å™¨ï¼š**
```go
// internal/infrastructure/di/container.go
type Container struct {
    config       *config.Config
    db           *sql.DB

    // ä»“å‚¨å±‚
    userRepo     domain.UserRepository
    fileRepo     domain.FileRepository

    // åº”ç”¨å±‚
    userUseCase  application.UserUseCase
    fileUseCase  application.FileUseCase

    // æ§åˆ¶å™¨å±‚
    userController presentation.UserController
    fileController presentation.FileController
}

func NewContainer(config *config.Config) (*Container, error) {
    container := &Container{config: config}

    // åˆå§‹åŒ–åŸºç¡€è®¾æ–½
    if err := container.initInfrastructure(); err != nil {
        return nil, err
    }

    // åˆå§‹åŒ–ä»“å‚¨
    container.initRepositories()

    // åˆå§‹åŒ–ç”¨ä¾‹
    container.initUseCases()

    // åˆå§‹åŒ–æ§åˆ¶å™¨
    container.initControllers()

    return container, nil
}
```

#### 3.4 é”™è¯¯å¤„ç†é‡æ„

**ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶ï¼š**
```go
// internal/domain/errors/errors.go
type DomainError struct {
    Code    string `json:"code"`
    Message string `json:"message"`
    Details map[string]interface{} `json:"details,omitempty"`
}

func (e DomainError) Error() string {
    return e.Message
}

var (
    ErrUserNotFound     = DomainError{Code: "USER_NOT_FOUND", Message: "ç”¨æˆ·ä¸å­˜åœ¨"}
    ErrInvalidPassword  = DomainError{Code: "INVALID_PASSWORD", Message: "å¯†ç é”™è¯¯"}
    ErrFileNotFound     = DomainError{Code: "FILE_NOT_FOUND", Message: "æ–‡ä»¶ä¸å­˜åœ¨"}
    ErrInsufficientAuth = DomainError{Code: "INSUFFICIENT_AUTH", Message: "æƒé™ä¸è¶³"}
)

// internal/presentation/http/middleware/error_handler.go
func ErrorHandler() gin.HandlerFunc {
    return gin.CustomRecovery(func(c *gin.Context, recovered interface{}) {
        if err, ok := recovered.(domain.DomainError); ok {
            c.JSON(http.StatusBadRequest, gin.H{
                "success": false,
                "error":   err,
            })
            return
        }

        // å¤„ç†å…¶ä»–ç±»å‹é”™è¯¯
        c.JSON(http.StatusInternalServerError, gin.H{
            "success": false,
            "error": map[string]string{
                "code":    "INTERNAL_ERROR",
                "message": "å†…éƒ¨æœåŠ¡å™¨é”™è¯¯",
            },
        })
    })
}
```

### ğŸš€ 4. åˆ†é˜¶æ®µé‡æ„è®¡åˆ’

#### é˜¶æ®µä¸€ï¼šåŸºç¡€æ¶æ„é‡æ„
1. **ç›®å½•ç»“æ„é‡ç»„**
   - åˆ›å»ºæ–°çš„ç›®å½•ç»“æ„
   - åˆ†ç¦»å‰åç«¯ä»£ç 
   - ç»Ÿä¸€é…ç½®ç®¡ç†

2. **ä¾èµ–æ³¨å…¥å®ç°**
   - å®ç°DIå®¹å™¨
   - é‡æ„ä¸»è¦æ¨¡å—çš„ä¾èµ–å…³ç³»

#### é˜¶æ®µäºŒï¼šé¢†åŸŸæ¨¡å‹é‡æ„
1. **æå–ä¸šåŠ¡å®ä½“**
   - å®šä¹‰ç”¨æˆ·ã€æ–‡ä»¶ã€æƒé™ç­‰å®ä½“
   - å®ç°ä¸šåŠ¡è§„åˆ™éªŒè¯

2. **ä»“å‚¨æ¨¡å¼å®ç°**
   - å®šä¹‰ä»“å‚¨æ¥å£
   - å®ç°æ•°æ®åº“ä»“å‚¨

#### é˜¶æ®µä¸‰ï¼šåº”ç”¨å±‚é‡æ„
1. **ç”¨ä¾‹å®ç°**
   - æå–ä¸šåŠ¡ç”¨ä¾‹
   - å®ç°ç”¨ä¾‹æ¥å£

2. **æœåŠ¡å±‚é‡æ„**
   - é‡æ„ç°æœ‰Handlerä¸ºController
   - å®ç°æ¸…æ™°çš„APIå±‚

#### é˜¶æ®µå››ï¼šæµ‹è¯•å’Œéƒ¨ç½²ä¼˜åŒ–
1. **æµ‹è¯•é‡æ„**
   - é‡ç»„æµ‹è¯•ç»“æ„
   - å¢åŠ å•å…ƒæµ‹è¯•è¦†ç›–ç‡

2. **éƒ¨ç½²ä¼˜åŒ–**
   - Dockeré•œåƒåˆ†ç¦»
   - éƒ¨ç½²è„šæœ¬ä¼˜åŒ–

### âœ… 5. é‡æ„åé¢„æœŸæ”¶ç›Š

#### 5.1 å¯ç»´æŠ¤æ€§æå‡
- **æ¨¡å—èŒè´£æ¸…æ™°**ï¼šæ¯ä¸ªæ¨¡å—æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œ
- **ä¾èµ–å…³ç³»ç®€åŒ–**ï¼šé€šè¿‡ä¾èµ–æ³¨å…¥é™ä½æ¨¡å—é—´è€¦åˆ
- **é…ç½®ç®¡ç†ç»Ÿä¸€**ï¼šé›†ä¸­åŒ–çš„é…ç½®ç®¡ç†

#### 5.2 å¯æ‰©å±•æ€§å¢å¼º
- **æ–°åŠŸèƒ½æ˜“äºæ·»åŠ **ï¼šæ¸…æ™°çš„æ¶æ„å±‚æ¬¡ä¾¿äºæ‰©å±•
- **ç¬¬ä¸‰æ–¹é›†æˆç®€åŒ–**ï¼šé€šè¿‡æ¥å£éš”ç¦»ä¾¿äºé›†æˆ
- **å¾®æœåŠ¡è¿ç§»å‹å¥½**ï¼šæ¨¡å—åŒ–è®¾è®¡ä¾¿äºæ‹†åˆ†æœåŠ¡

#### 5.3 ä»£ç è´¨é‡æå‡
- **æµ‹è¯•è¦†ç›–ç‡æé«˜**ï¼šåˆ†å±‚æ¶æ„ä¾¿äºå•å…ƒæµ‹è¯•
- **ä»£ç é‡ç”¨å¢åŠ **ï¼šé¢†åŸŸæ¨¡å‹å¯åœ¨å¤šä¸ªç”¨ä¾‹ä¸­é‡ç”¨
- **é”™è¯¯å¤„ç†ç»Ÿä¸€**ï¼šé›†ä¸­çš„é”™è¯¯å¤„ç†æœºåˆ¶

#### 5.4 å¼€å‘æ•ˆç‡æå‡
- **å¼€å‘æµç¨‹æ ‡å‡†åŒ–**ï¼šæ¸…æ™°çš„ç›®å½•ç»“æ„å’Œå‘½åè§„èŒƒ
- **å¹¶è¡Œå¼€å‘èƒ½åŠ›**ï¼šæ¨¡å—é—´ä½è€¦åˆä¾¿äºå›¢é˜Ÿåä½œ
- **è°ƒè¯•å’Œæ’é”™ç®€åŒ–**ï¼šæ¸…æ™°çš„æ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯
